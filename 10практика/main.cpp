#include <iostream>     // підключення бібліотеки для введення-виведення інформації
#include <thread>       // підключення бібліотеки для роботи з потоками
#include <vector>       // підключення бібліотеки для роботи з векторами
#include <random>       // підключення бібліотеки для генерації випадкових чисел
#include <mutex>        // підключення бібліотеки для синхронізації потоків
#include <iomanip>      // підключення бібліотеки для форматування виводу
#include <locale>       // підключення бібліотеки для роботи з локалізацією

using namespace std;    // використання стандартного простору імен

// Глобальні змінні для результатів
double sum_result = 0.0;      // змінна для збереження суми чисел більших за 15
double product_result = 1.0;  // змінна для збереження добутку чисел менших за 10
mutex mtx;                    // м'ютекс для синхронізації виводу на консоль
vector<double> arr(10);       // масив з 10 чисел типу double

// Функція для потоку T0 - знаходження суми чисел більших за 15
void thread_T0() {
    double local_sum = 0.0;   // локальна змінна для накопичення суми
    
    // Прохід по всіх елементах масиву
    for (int i = 0; i < arr.size(); i++) {
        if (arr[i] > 15.0) {  // перевірка умови: число більше за 15
            local_sum += arr[i]; // додавання числа до суми
        }
    }
    
    sum_result = local_sum;   // збереження результату в глобальну змінну
    
    // Синхронізований вивід результату
    lock_guard<mutex> lock(mtx); // блокування м'ютекса для безпечного виводу
    cout << "Потік T0 : Сума чисел більших за 15 = " << fixed << setprecision(2) << sum_result << endl;
}

// Функція для потоку T1 - знаходження добутку чисел менших за 10
void thread_T1() {
    double local_product = 1.0; // локальна змінна для накопичення добутку
    bool found = false;         // прапорець для перевірки наявності чисел менших за 10
    
    // Прохід по всіх елементах масиву
    for (int i = 0; i < arr.size(); i++) {
        if (arr[i] < 10.0) {    // перевірка умови: число менше за 10
            local_product *= arr[i]; // множення числа на добуток
            found = true;       // встановлення прапорця
        }
    }
    
    // Якщо не знайдено жодного числа менше 10, добуток дорівнює 0
    if (!found) {
        local_product = 0.0;
    }
    
    product_result = local_product; // збереження результату в глобальну змінну
    
    // Синхронізований вивід результату
    lock_guard<mutex> lock(mtx);    // блокування м'ютекса для безпечного виводу
    cout << "Потік T1 : Добуток чисел менших за 10 = " << fixed << setprecision(2) << product_result << endl;
}

int main() {
    // Встановлення кодування для правильного відображення українських символів
    setlocale(LC_ALL, "");
    
    cout << "=== Практична робота №10. Потоки (Варіант 10) ===" << endl;
    cout << "Студент: Пастух" << endl << endl;
    
    // Ініціалізація генератора випадкових чисел
    random_device rd;           // пристрій для отримання випадкового seed
    mt19937 gen(rd());          // генератор Mersenne Twister
    uniform_real_distribution<double> dis(0.0, 50.0); // рівномірний розподіл від 0 до 50
    
    // Заповнення масиву випадковими числами
    cout << "Ініціалізація масиву з 10 чисел типу double у проміжку (0..50):" << endl;
    for (int i = 0; i < 10; i++) {
        arr[i] = dis(gen);      // генерація випадкового числа
        cout << "arr[" << i << "] = " << fixed << setprecision(2) << arr[i] << endl;
    }
    cout << endl;
    
    // Створення та запуск потоків
    cout << "Запуск потоків:" << endl;
    thread t0(thread_T0);       // створення потоку T0
    thread t1(thread_T1);       // створення потоку T1
    
    // Очікування завершення потоків
    t0.join();                  // очікування завершення потоку T0
    t1.join();                  // очікування завершення потоку T1
    
    cout << endl << "=== Результати обчислень ===" << endl;
    cout << "Сума чисел більших за 15: " << fixed << setprecision(2) << sum_result << endl;
    cout << "Добуток чисел менших за 10: " << fixed << setprecision(2) << product_result << endl;
    
    return 0;                   // завершення програми
}